---
title: "TP1"
author: "Cristian Salinas"
date: "2023-10-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r install-libraries, include=FALSE}
library('tidyverse')# Data manipulation, visualization, and analysis.
library('here')#Refer to files without hardcoding the full path
library(dplyr) #manipulacion de datos
library(readxl)#lectura
library(kableExtra) #tablas
library(ggplot2) #graficos
library(ggpubr) #para juntar
library(ggforce) # grafico de violin y jitter
library(GGally) # ggpairs
library(corrplot) # para correlogramas
library(summarytools) #tools and functions for generating descriptive statistics, summary tables, and reports for data analysis and data exploration in R
library(fmsb) #descriptive statistics, hypothesis testing, and data visualization
library(ggcorrplot) #visualizing correlations between variables in a dataset
```
```{r file-paths, include=FALSE }
# With here::here(), you don't need to worry about the specific file path or whether your code will work on different operating systems. It helps make your code more portable and project-independent by automatically resolving file paths based on the location of your script.
here::here()
```

### **Ejercicio 1** - Transformaciones de datos

Seis candidatas son evaluadas para el puesto de recepcionista en una empresa, para ello pasan por dos entrevistas. En la primera las evalúa el responsable de recursos humanos de la empresa (juez 1) y en la segunda el responsable del área de la cual van a depender (juez 2). La asignación de puntajes es en cordialidad, presencia y manejo de idiomas. Los puntajes asignados independientemente por estos jueces se encuentran en el archivo recepcionistas.xls.

#### Calcule el promedio por juez de cada una de las aspirantes.

```{r calculo-promedio, echo = FALSE}
recepcionistas <- read_excel("recepcionistas.xls")
colnames(recepcionistas) <- gsub(" ", "", colnames(recepcionistas))
#Se transforman los datos para responder las preguntas del trabajo practico.
recep_tidy = recepcionistas %>% pivot_longer(cols = 2:7, # Columnas que se quieren transformar
                                             names_to = "variable",   # Nombre de la nueva columna de variables
                                             values_to = "puntuacion") %>%
                                separate_wider_delim(variable, delim = ".", names = c("rubro", "juez")) %>% #Separar la columna Variable en dos columnas Rubro y Juez
                                mutate(candidatos = as.factor(candidatos), rubro = as.factor(rubro), juez = as.factor(juez)) #Cambiar los valores a tipo factor
                                #A factor is a data type in R used for categorical variables

#Calcular el promedio por juez de cada una de las aspirantes.

promedio_puntuaciones = recep_tidy %>% group_by(juez, candidatos) %>% summarise(promedio = mean(puntuacion)) %>% pivot_wider(names_from = juez, values_from = promedio)
new_column_names <- c("Aspirantes", "Juez1", "Juez2")
names(promedio_puntuaciones) <- new_column_names
promedio_puntuaciones
```

#### ¿Cuál le parece que seleccionaría cada uno de ellos?

```{r, echo = FALSE}
promedio_puntuaciones %>% select(-Juez2) %>% filter(Juez1 == max(Juez1))
promedio_puntuaciones %>% select(-Juez1) %>% filter(Juez2 == max(Juez2))
```
```{r, include=FALSE}
#recep_tidy %>% 
#  group_by(juez, candidatos) %>% 
#  summarise(promedio = mean(puntuacion)) %>% 
#  filter(juez =="juez1") %>% 
#  arrange(-promedio)

#recep_tidy %>% 
#  group_by(juez, candidatos) %>% 
#  summarise(promedio = mean(puntuacion)) %>% 
#  filter(juez =="juez2") %>% 
#  arrange(-promedio)
```

#### ¿Existe coincidencia?

No hay coincidencia en los resultados obtenidos por los jueces. Mientras que el Juez1 selecciona a Mariana con un promedio de 80 puntos, el Juez2 selecciona a Maia con un puntaje promedio de 73.33 puntos.

#### Calcule el promedio de cada una de las aspirantes tomando en cuenta todos los rubros y ambos jueces.

```{r, echo = FALSE}
recep_tidy %>% 
  group_by(candidatos) %>% 
  summarise(promedio = mean(puntuacion)) %>% 
  arrange(-promedio)
```

#### Transformar las puntuaciones observadas de modo tal que cada una de las seis variables tenga media 0 y dispersión 1. ¿Cuál sería el objetivo de esta transformación?

Este proceso tiene como objetivo centralizar los datos alrededor de una media de 0 y escalarlos para tener una desviación estándar de 1. La estandarización facilita la comparación entre variables, mejora la visualización de datos y cumple con las suposiciones de muchos modelos estadísticos. Sin embargo, es importante recordar que la estandarización no siempre es necesaria y debe adaptarse a las necesidades específicas de cada tarea de análisis o modelado.

```{r, echo = FALSE}
#Transformar datos para cada variable con media 0 y dispersión 1
recepcionistas_scale= cbind(candidatos=recepcionistas$candidatos, data.frame(scale(recepcionistas[,2:7])))
```

#### Transformar las puntuaciones de modo tal que cada candidata tenga para cada juez media 0 y dispersión 1. ¿Cuál sería el objetivo de esta transformación?

```{r, echo = FALSE}
recep_tidy_scale = recepcionistas_scale %>% pivot_longer(cols = 2:7, # Columnas que se quieren transformar
                                            names_to = "variable",   # Nombre de la nueva columna de variables
                                            values_to = "puntuacion") %>%
                                separate_wider_delim(variable, delim = ".", names = c("rubro", "juez")) %>% #Separar la columna Variable en dos columnas Rubro y Juez
                                mutate(candidatos = as.factor(candidatos), rubro = as.factor(rubro), juez = as.factor(juez)) #Cambiar los valores a tipo factor
                                #A factor is a data type in R used for categorical variables

#Calcular el promedio por juez de cada una de las aspirantes.

promedio_puntuaciones_scale = recep_tidy_scale %>% group_by(juez, candidatos) %>% summarise(promedio = mean(puntuacion)) %>% pivot_wider(names_from = juez, values_from = promedio)
new_column_names <- c("Aspirantes", "Juez1", "Juez2")
names(promedio_puntuaciones_scale) <- new_column_names
promedio_puntuaciones_scale
```

####  Grafique los perfiles multivariados de cada una de las candidatas para ambas transformaciones. ¿Qué observa?

```{r, echo = FALSE, out.width='100%', fig.align='center'}
recep_tidy_scale %>% ggplot(aes(x=puntuacion, y = candidatos, fill = juez)) + geom_boxplot() 
```

```{r, echo = FALSE, out.width='100%', fig.align='center'}
ggplot(recep_tidy_scale,aes(x=rubro,y=puntuacion,color=candidatos))+
  geom_line(aes(group =candidatos))+ 
  labs(title = "juez") + 
  theme(axis.text.x  = element_text(angle=90))+
  facet_row(~juez)
```

### **Ejercicio 2** - Tipos de variables resúmenes: Internet. 2013

#### Clasificar las variables de la base. Para las variables numéricas construir un gráfico de coordenadas paralelas.

```{r, echo = FALSE, out.width='100%', fig.align='center'}
internet = read_excel("Internet2013.xls")
#gráfico de cajas (no lo pide el enunciado)
internet %>% select(Nacionalidad,
                    Edad,
                    Estatura,
                    Uso,
                    Temperatura,
                    Autos,
                    Cigarrillos) %>% 
  mutate_if(is.numeric, ~scale(.)) %>% 
  pivot_longer(names_to ="Variable", values_to = 'Valor', cols = 2:7) %>% 
  ggplot(aes(x=Valor, y= Variable, fill = Nacionalidad))+
  geom_boxplot(alpha=0.5)

#gráfico de coordenadas paralelas
internet %>% select(Nacionalidad,
                    Edad,
                    Estatura,
                    Uso,
                    Temperatura,
                    Autos,
                    Cigarrillos) %>% 
  mutate_if(is.numeric, ~scale(.)) %>% 
  group_by(Nacionalidad) %>% summarize_all(mean) %>% 
  ggparcoord(columns = 2:7,  # Variables on x-axis
             groupColumn = "Nacionalidad", #Variable on y-axis 
             alphaLines = 0.5)
```


#### Construir la tabla de frecuencias de la variable sexo.

```{r, echo = FALSE, out.width='100%', fig.align='center'}
table(internet$Sexo) #counts the frequency of each unique value or combination of values in one or more categorical variables and presents the counts in a tabular format
internet %>% ggplot(aes(x=Sexo))+geom_bar()
```

#### ¿Hay algún valor que llame la atención? ¿Qué tipo de error considera que es?

Existe un unico registro que no contiene un valor esperado para la variable categorica sexo que es el 0. Esto seguramente se debe a un error durante la carga de los datos. 

#### Ordenar los datos por la variable Edad.

```{r, echo = FALSE}
internet$Edad %>% summary()
internet %>% group_by(Edad) %>% summarise(Frecuencia = n()) %>% arrange(-Edad)
internet %>% filter(Edad < 0 | Edad>110)
```

#### ¿Encontró algún valor extraño? ¿Qué tipo de error puede ser? 

Existen varios registros que indican ocurrencias de edades erroneas, entre ellas:

- Un registro que indica una edad de 120
- Un registro que indica una edad de 180
- Un registro que indica una edad de 280
- Un registro que indica una edad de -44

#### Construir la tabla de frecuencias de la variable Sitio.

```{r, echo = FALSE}
#La variable sitio es una variable categorica que indica el sitio preferido al que se conecta cada individuo siendo:
# 1- chat,  2 - correo electrónico 3-buscadores 4 – software 5 – música 6 – deportes 7 - otros

internet$Sitio %>% summary()
internet %>% group_by(Sitio) %>% summarise(Frecuencia = n()) %>% arrange(-Sitio)
table(internet$Sitio)
```
#### ¿Encuentra algún valor que le llame la atención? ¿Qué tipo de error puede ser?

Existen varios registros que cuyos valores escapan a los valores establecidos para la variable categorica sitio, entre ellos:

- Un registro que indica un valor de 8 (no corresponde a ningun valor esperado para esta variable que solo toma los valores del 1 al 7)
- Un registro que indica un valor de 28 (no corresponde a ningun valor esperado para esta variable que solo toma los valores del 1 al 7)

#### Proceda de forma similar para las variables Temperatura, Autos y Cigarrillos.

### Analisis Temperatura
```{r, echo = FALSE, out.width='100%', fig.align='center'}
#internet %>% summary()
internet$Temperatura %>% summary()
internet %>% group_by(Temperatura) %>% summarise(Frecuencia = n()) %>% arrange(-Temperatura)
internet %>% filter(Temperatura > 40) %>% select(Temperatura)

#Calcular la cantidad de intervalos en los cuales clasificar los registros de acuerdo a la variable temperatura
k = 10 * log(nrow(internet))#dixo
k2 = 1 + 3.322 * log(nrow(internet))#strudges

temperaturas = internet %>% select(Temperatura) %>% 
               mutate(temperatura = cut(Temperatura, breaks  = k2)) %>% 
               group_by(temperatura) %>%
               summarise(fi = n()) %>%
               mutate(f = fi / sum(fi) * 100)

count_bars = round(k2) 
colors = rainbow(count_bars)
internet %>% select(Temperatura) %>% ggplot(aes(x=Temperatura)) + geom_histogram(bins = round(k2), fill=colors, color='black')
```
#### ¿Encuentra algún valor que le llame la atención? ¿Qué tipo de error puede ser?

Existen dos registros que cuyos valores escapan a los valores establecidos para la variable temperatura, entre ellos:

- Un registro que indica una temperatura media anual de 94 grados celcius
- Un registro que indica una temperatura media anual de 131 grados celcius


### Analisis Autos

```{r, echo = FALSE}
internet$Autos %>% summary()
internet %>% group_by(Autos) %>% summarise(Frecuencia = n()) %>% arrange(-Autos)
internet %>% select(Autos) %>% ggplot(aes(x=Autos))+geom_boxplot(fill = 'blue', color='black')
internet %>% filter(Autos >200)
```
#### ¿Encuentra algún valor que le llame la atención? ¿Qué tipo de error puede ser?

Existe un registro que indica la presencia de 2680 autos en una unica manzana, lo cual indica un claro error en el valor ingresado.

### Analisis Cigarrillos

```{r, echo = FALSE}
#Cantidad de cigarrillos consumidos mientras se utiliza Internet
internet$Cigarrillos %>% summary()
internet %>% group_by(Cigarrillos) %>% summarise(Frecuencia = n()) %>% arrange(-Cigarrillos)
internet %>% select(Cigarrillos) %>% ggplot(aes(x=Cigarrillos))+geom_boxplot(fill = 'blue', color='black')
internet %>% filter(Cigarrillos >25)
```

#### ¿Encuentra algún valor que le llame la atención? ¿Qué tipo de error puede ser?

Existen varios registros que cuyos valores son extremadamente elevados al punto de considerarse altamente improbables y erroneos:

- Un individuo que consume 100 cicarrillos mientras utiliza internet
- Un individuo que consume 75 cicarrillos mientras utiliza internet

#### Elimine de la base los valores que no son posibles y que seguramente corresponde a un error de tipeo. 
(Hacer)

#### ¿Para cuáles de las variables tiene sentido calcular la media? ¿Y la mediana?

Tiene sentido calcular media y mediana paraquellas variables que son numericas, no asi para las categoricas.

#### ¿Cuáles de las variables le parecen simétricas a partir de estos resúmenes? Confirme estas observaciones mediante un boxplot.

Las variables con mayor simetria son las correspondientes a:

- Autos
- Cigarrillos

```{r, echo = FALSE}
internet %>% select(Nacionalidad,
                    Edad,
                    Estatura,
                    Uso,
                    Temperatura,
                    Autos,
                    Cigarrillos) %>% 
  mutate_if(is.numeric, ~scale(.)) %>% 
  pivot_longer(names_to ="Variable", values_to = 'Valor', cols = 2:7) %>% 
  ggplot(aes(x=Valor, y= Variable))+
  geom_boxplot(alpha=0.5)
```

####  Calcular la desviación intercuartil y detectar presencia de valores salvajes moderados y severos.

Se utiliza como ejemplo la variable Estatura, donde los siguientes valores se consieran salvajes. No se encontraron valores severos.

```{r, echo = FALSE}
internet$Estatura %>% summary()
ggplot(internet, aes(x=Estatura)) + geom_boxplot()

q3 = quantile(internet$Estatura, 0.75)
q1 = quantile(internet$Estatura, 0.25)
riq = IQR(internet$Estatura)

#1.5 veces es salvaje
#3 veces es severo

li_salvaje = (q1 - 1.5 * riq)[[1]]
ls_salvaje = as.numeric(q3 +1.5 * riq )

li_severo = (q1 - 3 * riq)[[1]]
ls_severo = (q3 + 3 * riq )[[1]]

tolerance = 1e-6

internet %>% select(Estatura) %>% group_by(Estatura) %>% summarise(Frecuencia = n()) %>% mutate(Salvaje = (Estatura < li_salvaje | Estatura > ls_salvaje + tolerance ))  %>% filter(Salvaje == TRUE)

internet %>% select(Estatura) %>% group_by(Estatura) %>% summarise(Frecuencia = n()) %>% mutate(Severo = (Estatura < li_severo | Estatura > ls_severo + tolerance ))  %>% filter(Severo == TRUE)

internet %>% mutate(Categoria = case_when(Estatura < li_salvaje | Estatura > ls_salvaje + tolerance ~ "Salvaje",
                                         Estatura < li_severo | Estatura > ls_severo + tolerance ~ "Severo",
                                         TRUE ~ "Normal")) %>% # Set other rows to Normal
                group_by(Categoria) %>% summarise(Frecuencia = n())

```

### **Ejercicio 3** Gráficos univariados y multivariados - Gorriones.xls

```{r}
gorriones <- read_excel("gorriones.xlsx")
```

```{r}
gorriones %>% head(3)
```

```{r}
gorriones %>% summary()
```
(a) Indicar en cada caso de que tipo de variable se trata.
Pajaro : ID
Sobrevida : Factor

```{r}
str(gorriones)
```
```{r}
gorriones = gorriones %>% 
  mutate(sobrevida = as.factor(sobrevida))

gorriones %>% head(3)
```
```{r}

```


```{r}
gorriones %>% 
  select(humero, cabeza, sobrevida) %>% #columnas
  filter(humero > 18, cabeza < 50) %>% # filas
  mutate(nuevoColumna = humero **2, 
         nuevaColumna2 = nuevoColumna /2,
         humero = humero/100) %>% # crea columnas calculadad o editadas
  group_by(sobrevida) %>% #siempre desp del GBy viene una f(X) de transformacion o agregacion
  #summarise_all(mean)
  summarise(promedio = mean(humero), 
            desvio = sd(humero))

#verbos
# Select => columnas
# filter => filas
# mutate
# group by
# summarise
```
(b) Confeccionar un informe para cada variable( univariado).
https://cran.r-project.org/web/packages/summarytools/vignettes/introduction.html



```{r}
gorriones %>% summary()
```
```{r}
descr(gorriones)
```

```{r}
dfSummary(gorriones)
```


```{r}
dfSummary(gorriones) %>% view()
```

(c) Realizar en el caso que corresponda un histograma. Ensayar el número de intervalos que conviene en cada variable, indicar si utiliza algún criterio.

```{r}
k = 10 * log(nrow(gorriones))#dixo
k2 = 1 + 3.322 * log(nrow(gorriones))#strudges
hlargoT = 3.49 * sd(gorriones$largototal) * nrow(gorriones)**-(1/3)
```

Ejemplo GGPLOT
```{r}
ggplot(gorriones   ,    aes(x=largototal, y = humero))  +
  geom_point(aes( color = extension, size = extension, shape = sobrevida))+
  geom_line()

```


```{r}
#colnames(gorriones)[c(2,3,4,5,6)]
ggplot(gorriones, aes(x=largototal)) +
  geom_histogram(bins = round(k2),fill = 'red', color='black')
  

```

```{r}
ggplot(gorriones, aes(x=largototal)) +
    geom_histogram(binwidth = hlargoT, fill = 'red', color='black' )
```

(d) Realizar un boxplot comparativo para cada una de estas variables par- ticionando por el grupo definido por la supervivencia. ¿Le parece que alguna de estas variables está relacionada con la supervivencia, es decir que toma valores muy distintos en ambos grupos? Analizar en todos los casos la presencia de outliers.

```{r}
ggplot(gorriones, aes(x= humero, y = sobrevida)) +
  geom_boxplot()
```

```{r}
recepcionistas %>% pivot_longer(cols = 2:7, names_to = 'rubrojuez', values_to = 'valores') %>% 
  separate_wider_delim(rubrojuez, delim = ".", names = c("rubro", "juez"))
  
```



#Ojo!!, las variables estan transformadas

```{r}
gorriones %>% select(largototal,
                    extension,
                    cabeza,
                    humero,
                    esternon,
                    sobrevida) %>% 
  mutate_if(is.numeric, ~scale(.)) %>% 
  pivot_longer(names_to ="Variable", values_to = 'Valor', cols = 1:5) %>% 
  ggplot(aes(x=Valor, y= Variable, fill = sobrevida))+
  geom_boxplot(alpha=0.5)
```

```{r}
gorriones %>% select(largototal,
                    extension,
                    cabeza,
                    humero,
                    esternon,
                    sobrevida) %>% 
  mutate_if(is.numeric, ~scale(.)) %>% 
  pivot_longer(names_to ="Variable", values_to = 'Valor', cols = 1:5) %>% 
  ggplot(aes(x=Valor, y= Variable, fill = sobrevida))+
  geom_boxplot(alpha=0.5)
```

(e) Construir gráficos bivariados para las todas las variables, particionan- do por el grupo de supervivencia (un color para cada grupo). ¿Observa alguna regularidad que pueda explicar la supervivencia?



```{r}

ggpairs(gorriones, columns = 2:7, aes(color=sobrevida, alpha=0.5))
```


```{r}
ggplot(gorriones, aes(x=largototal, y = extension, color=sobrevida))+
  geom_point(alpha=0.7)+
  geom_smooth(method = lm )
```
(f) Construir la matriz de diagramas de dispersión. ¿Considera que algún par de estas medidas están relacionadas? Estudiar si la asociación de al- gunas de estas medidas es diferente en alguno de los grupos.

```{r}

#http://www.sthda.com/english/wiki/ggcorrplot-visualization-of-a-correlation-matrix-using-ggplot2
```

```{r}
cor(gorriones[,2:6])
```
```{r}

ggcorrplot(cor(gorriones[,2:6]), hc.order = TRUE, type = "lower",
   lab = TRUE)
```

## Ejercicio 4

```{r}
razaperros <- read_excel("razaperros.xls")
```


(a) Realizar un gráfico de estrellas por raza (utilizando las variables tamaño, peso, velocidad, inteligencia y afectividad.


```{r}
razaperros
```

```{r}

```


```{r}
ggplot(data = razaperros, aes(x = inteligencia)) + geom_bar(fill = "lightblue", colour = "black")+ coord_polar() + 
  facet_wrap(~raza)
```

```{r}
recepcionistas %>% pivot_longer(cols = 2:7, values_to = 'puntos', names_to = 'variables') %>% 
  pivot_wider(names_from = variables, values_from = puntos) 
```
```{r}

stars(razaperros[,2:6], full=F, cex=0.8, flip.labels = T, labels = razaperros$raza, col.stars = cm.colors(9))
```

```{r}

# Create data: note in High school for Jonathan:
data <- as.data.frame(matrix( sample( 2:20 , 10 , replace=T) , ncol=10))
colnames(data) <- c("math" , "english" , "biology" , "music" , "R-coding", "data-viz" , "french" , "physic", "statistic", "sport" )
 
# To use the fmsb package, I have to add 2 lines to the dataframe: the max and min of each topic to show on the plot!
data <- rbind(rep(20,10) , rep(0,10) , data)
 
# Check your data, it has to look like this!
# head(data)

# The default radar chart 
radarchart(data)
```



